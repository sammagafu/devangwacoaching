import{b9 as y,y as C,q as i,J as $}from"./index-BKxaJmes.js";const m=y("cart",()=>{const o=C.useToast(),a=i([]),n=i(!1),g=()=>{try{const e=localStorage.getItem("cart");if(e){const r=JSON.parse(e);Array.isArray(r)&&(a.value=r.filter(s=>s.slug&&s.type))}}catch(e){console.error("Failed to load cart from local storage:",e)}},c=()=>{try{localStorage.setItem("cart",JSON.stringify(a.value))}catch(e){console.error("Failed to save cart to local storage:",e)}},p=async()=>{if(!n.value){n.value=!0;try{if(!a.value.length){a.value=[],c();return}const e=await Promise.all(a.value.map(async r=>{var l;const s=r.type==="course"?`/course/courses/${r.slug}/`:`/events/${r.slug}/`;try{const t=(await $.get(s)).data;if(!t.slug||!t.title)throw new Error("Invalid item data");return{slug:t.slug,type:r.type,title:t.title,image:t.image||(r.type==="course"?"/default-course-image.jpg":"/default-event-image.jpg"),category:r.type==="course"&&((l=t.tags)==null?void 0:l.length)>0?t.tags[0].tag:"general",final_price:Number(t.final_price)||0,price:Number(t.price)||Number(t.final_price)||0}}catch(u){return console.error(`Failed to load ${r.type} ${r.slug}:`,u),o.error(`Failed to load ${r.type} "${r.title||r.slug}".`),null}}));a.value=e.filter(r=>r!==null),c(),a.value.length||o.info("Your cart is empty or contains invalid items.")}catch(e){console.error("Failed to fetch cart items:",e),o.error("Failed to load cart items. Please try again."),a.value=[],c()}finally{n.value=!1}}},d=e=>{if(!e.slug||!e.type||!e.title){o.error("Invalid item. Cannot add to cart.");return}a.value.some(r=>r.slug===e.slug&&r.type===e.type)?o.info(`${e.type==="course"?"Course":"Event"} "${e.title}" is already in cart.`):(a.value.push({...e,final_price:Number(e.final_price)||0,price:Number(e.price)||Number(e.final_price)||0,image:e.image||(e.type==="course"?"/default-course-image.jpg":"/default-event-image.jpg"),category:e.category||"general"}),c(),o.success(`${e.type==="course"?"Course":"Event"} "${e.title}" added to cart.`))},f=(e,r)=>{const s=a.value.findIndex(l=>l.slug===e&&l.type===r);if(s!==-1){const l=a.value[s];a.value.splice(s,1),c(),o.info(`${r==="course"?"Course":"Event"} "${l.title||e}" removed from cart.`)}},v=()=>{a.value=[],c(),o.info("Cart cleared.")};return g(),{cartItems:a,isLoading:n,fetchCartItems:p,addToCart:d,removeFromCart:f,clearCart:v}});export{m as u};
