import{y as re,q as m,E as le,c as f,o as c,w as t,b as r,$ as ne,H as ie,a as u,t as i,L as ue,g as n,X as ce,W as de,i as F,m as z,F as E,aE as me,Y as pe,D as q,ar as _e,at as ye,J as _,a$ as ve,b4 as fe,x as b,V as ke,s as he}from"./index-N9CDaHOP.js";/* empty css                    */import{_ as be}from"./StudentLayout.vue_vue_type_script_setup_true_lang-nICzxTwo.js";import"./menu-items-1Og9OzUr.js";import"./index-DdoyQ2gK.js";import"./index-DwNiKAmd.js";import"./TopBar8.vue_vue_type_script_setup_true_lang-CjTKH_W-.js";import"./StickyHeader.vue_vue_type_script_setup_true_lang-CZa3rg2A.js";import"./ProfileDropdown.vue_vue_type_script_setup_true_lang-MiOOsD2a.js";import"./DropDown.vue_vue_type_script_setup_true_lang-CvqxUwdC.js";import"./change-casing-BoyW-fpY.js";import"./01-DeMBLNXD.js";import"./ShopCart.vue_vue_type_script_setup_true_lang-CqdS6fSh.js";import"./ChoicesSelect.vue_vue_type_script_setup_true_lang-DiCDSqEv.js";import"./02-CA1hCPq5.js";import"./04-D66rD-0h.js";import"./AdvanceMenu.vue_vue_type_script_setup_true_lang-CDVthnuR.js";import"./constants-DJzGRNcz.js";import"./index.vue_vue_type_script_setup_true_lang-Dq_y5vYq.js";import"./LogoBox.vue_vue_type_script_setup_true_lang-wpPX1rPk.js";import"./MobileNavbarToggler-Bj1WYEMd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./menu-C3R5rgoV.js";import"./Footer7.vue_vue_type_script_setup_true_lang-c4vRZI93.js";import"./index-DLdkP7uh.js";import"./logo-light-sT18Thxh.js";import"./04-DIykCGoU.js";import"./09-BzxBVZmI.js";const we={class:"h3 mb-2 mb-sm-0"},ge={class:"mb-0"},Fe={class:"mb-0"},Ce=u("strong",null,"Views:",-1),Te=u("strong",null,"Likes:",-1),$e=u("strong",null,"Replies:",-1),Ve=u("h6",null,"Replies",-1),Re={class:"mb-0"},Se=u("strong",null,"Likes:",-1),xe={class:"mb-0"},Le=u("strong",null,"Likes:",-1),nt={__name:"CommunityThreads",setup(Ne){const l=re.useToast(),B=ve(),X=fe(),C=m([]),w=m(""),D=m(null),y=m(null),g=m(!1),k=m(""),h=m(""),x=m(!1),T=m({}),$=m({}),V=m({}),R=m({}),Y=async()=>{try{const e=await _.get(`community/categories/${B.params.slug}/`);w.value=e.data.name,D.value=e.data.id}catch(e){console.error("Failed to fetch category:",e),l.error("Failed to fetch category"),X.push("/community")}},v=async()=>{try{const e=await _.get(`community/threads/community/${B.params.slug}/`);C.value=e.data.results,C.value.length>0&&!w.value&&(w.value=C.value[0].category.name),l.success("Threads loaded successfully!")}catch(e){console.error("Failed to fetch threads:",e),l.error("Failed to fetch threads")}},J=async()=>{try{const e=await _.get("auth/users/me/");y.value=e.data}catch(e){console.error("Failed to fetch user:",e),l.error("Failed to fetch user data")}},A=()=>(h.value="",k.value.trim()?!0:(h.value="Thread content is required",!1)),G=async()=>{if(A()){x.value=!0;try{await _.post("community/threads/",{content:k.value,category:D.value}),l.success(`Thread created in ${w.value}!`),g.value=!1,k.value="",await v()}catch(e){console.error("Failed to create thread:",e),e.response&&e.response.data?e.response.data.category?l.error("Invalid community"):e.response.data.content?h.value=e.response.data.content[0]:l.error("Failed to create thread"):l.error("Failed to create thread")}finally{x.value=!1}}},K=async e=>{try{await _.post("community/replies/",{thread:e,content:$.value[e]}),l.success("Reply created successfully!"),$.value[e]="",T.value[e]=!1,await v()}catch(a){console.error("Failed to create reply:",a),l.error("Failed to create reply")}},O=async(e,a)=>{try{await _.post("community/replies/",{thread:e,content:R.value[a],parent:a}),l.success("Nested reply created successfully!"),R.value[a]="",V.value[a]=!1,await v()}catch(d){console.error("Failed to create nested reply:",d),l.error("Failed to create nested reply")}},P=async e=>{try{await _.post(`community/threads/${e}/like/`),l.success("Thread liked successfully!"),await v()}catch(a){console.error("Failed to like thread:",a),l.error("Failed to like thread")}},Q=async e=>{try{await _.post(`community/threads/${e}/unlike/`),l.success("Thread unliked successfully!"),await v()}catch(a){console.error("Failed to unlike thread:",a),l.error("Failed to unlike thread")}},Z=async e=>{try{await _.post(`community/posts/${e}/like/`),l.success("Reply liked successfully!"),await v()}catch(a){console.error("Failed to like reply:",a),l.error("Failed to like reply")}},I=async e=>{try{await _.post(`community/posts/${e}/unlike/`),l.success("Reply unliked successfully!"),await v()}catch(a){console.error("Failed to unlike reply:",a),l.error("Failed to unlike reply")}},H=e=>!e.likes||!y.value?!1:e.likes.some(a=>a.user.id===y.value.id),M=e=>!e.likes||!y.value?!1:e.likes.some(a=>a.user.id===y.value.id),L=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),ee=()=>{k.value="",h.value="",g.value=!1};return le(()=>{Y(),v(),J()}),(e,a)=>{const d=ue,j=ie,te=ne,ae=ke,S=de,N=ye,U=pe,W=ce,oe=_e,se=me;return c(),f(be,null,{default:t(()=>[r(j,{xl:"9"},{default:t(()=>[r(te,{class:"mb-3"},{default:t(()=>[r(j,{cols:"12",class:"d-sm-flex justify-content-between align-items-center"},{default:t(()=>[u("h1",we,"Community Threads: "+i(w.value),1),r(d,{variant:"primary",onClick:a[0]||(a[0]=o=>g.value=!0)},{default:t(()=>[n("Create New Thread")]),_:1})]),_:1})]),_:1}),r(W,{"no-body":"",class:"bg-transparent"},{default:t(()=>[r(S,{class:"px-0"},{default:t(()=>[(c(!0),F(E,null,z(C.value,o=>(c(),f(W,{key:o.id,class:"mb-3"},{default:t(()=>[r(ae,null,{default:t(()=>[u("h5",null,i(o.content.substring(0,50))+"...",1),u("p",ge,"Started by "+i(o.starter.username)+" on "+i(L(o.created_at)),1)]),_:2},1024),r(S,null,{default:t(()=>[u("p",null,i(o.content),1),u("p",Fe,[Ce,n(" "+i(o.views)+" | ",1),Te,n(" "+i(o.likes_count)+" | ",1),$e,n(" "+i(o.replies_count),1)]),y.value&&!H(o)?(c(),f(d,{key:0,variant:"outline-primary",size:"sm",onClick:s=>P(o.slug)},{default:t(()=>[n(" Like ")]),_:2},1032,["onClick"])):b("",!0),y.value&&H(o)?(c(),f(d,{key:1,variant:"outline-danger",size:"sm",onClick:s=>Q(o.slug)},{default:t(()=>[n(" Unlike ")]),_:2},1032,["onClick"])):b("",!0),r(d,{variant:"primary",size:"sm",class:"ms-2",onClick:s=>T.value[o.id]=!T.value[o.id]},{default:t(()=>[n(" Reply ")]),_:2},1032,["onClick"])]),_:2},1024),T.value[o.id]?(c(),f(S,{key:0},{default:t(()=>[r(U,{onSubmit:q(s=>K(o.id),["prevent"])},{default:t(()=>[r(N,{modelValue:$.value[o.id],"onUpdate:modelValue":s=>$.value[o.id]=s,placeholder:"Enter your reply",rows:"3",required:""},null,8,["modelValue","onUpdate:modelValue"]),r(d,{type:"submit",variant:"primary",class:"mt-2"},{default:t(()=>[n("Submit Reply")]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)):b("",!0),r(S,null,{default:t(()=>[Ve,(c(!0),F(E,null,z(o.replies,s=>(c(),F("div",{key:s.id,class:"mb-2",style:he({marginLeft:s.parent?"20px":"0"})},[u("p",null,i(s.content),1),u("p",Re,[n(" By "+i(s.author.username)+" on "+i(L(s.created_at))+" | ",1),Se,n(" "+i(s.likes_count),1)]),y.value&&!M(s)?(c(),f(d,{key:0,variant:"outline-primary",size:"sm",onClick:p=>Z(s.id)},{default:t(()=>[n(" Like ")]),_:2},1032,["onClick"])):b("",!0),y.value&&M(s)?(c(),f(d,{key:1,variant:"outline-danger",size:"sm",onClick:p=>I(s.id)},{default:t(()=>[n(" Unlike ")]),_:2},1032,["onClick"])):b("",!0),r(d,{variant:"primary",size:"sm",class:"ms-2",onClick:p=>V.value[s.id]=!V.value[s.id]},{default:t(()=>[n(" Reply ")]),_:2},1032,["onClick"]),V.value[s.id]?(c(),f(U,{key:2,onSubmit:q(p=>O(o.id,s.id),["prevent"]),class:"mt-2"},{default:t(()=>[r(N,{modelValue:R.value[s.id],"onUpdate:modelValue":p=>R.value[s.id]=p,placeholder:"Enter your reply",rows:"3",required:""},null,8,["modelValue","onUpdate:modelValue"]),r(d,{type:"submit",variant:"primary",class:"mt-2"},{default:t(()=>[n("Submit Reply")]),_:1})]),_:2},1032,["onSubmit"])):b("",!0),(c(!0),F(E,null,z(s.replies||[],p=>(c(),F("div",{key:p.id,class:"mb-2",style:{"margin-left":"20px"}},[u("p",null,i(p.content),1),u("p",xe,[n(" By "+i(p.author.username)+" on "+i(L(p.created_at))+" | ",1),Le,n(" "+i(p.likes_count),1)])]))),128))],4))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),r(se,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=o=>g.value=o),title:"Create New Thread",onHidden:ee},{default:t(()=>[r(U,{onSubmit:q(G,["prevent"])},{default:t(()=>[r(oe,{label:"Thread Content","label-for":"thread-content","invalid-feedback":h.value},{default:t(()=>[r(N,{id:"thread-content",modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=o=>k.value=o),placeholder:"Enter thread content",rows:"5",required:"",state:h.value?!1:null},null,8,["modelValue","state"])]),_:1},8,["invalid-feedback"]),r(d,{type:"submit",variant:"primary",disabled:x.value},{default:t(()=>[n("Create Thread")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}};export{nt as default};
